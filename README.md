# AVRASM_ShiftReg_Lib
ASM Библиотека для простой работы со сдвиговыми регистрами 74HC164 на AVR

###	Create by S.P.S 2012(c)
###	Версия: 1.2

==============================================================================
Библиотека состоит из трех файлов:

	shift164.asm		основной файл библиотеки

	init_sh164.asm		инициализация библиотеке - тут делаем все 
				необходимые настройки

	shift164_macro.asm	макросы для работы с библиотекой. Служебные 
				обязательны, а рабочие можно своими дополнить, 
				а можно удалить вовсе.
==============================================================================
В проект файлы подключаются командой

	.include "shift164_macro.asm"

==============================================================================
Расположение файлов в проекте следующее:

	shift164.asm		в конце программы, перед   .ESEG 

	init_sh164.asm		в сегменте   .DSEG 

	shift164_macro.asm	в самом верху, перед   .DSEG

На всякий случай в каждом файле, в шапке, есть памятка о расположении
 и функциях этого файла.

==============================================================================
Работа с библиотекой:

Для работы с библиотекой необходимо разместить ее файлы в теле проекта 
(см. выше), и настроить в файле инициализации init_sh164.asm 
следующие параметры:

	bufsize	 ; размер буфера отправки 0..RAMEND
	         ; напр. для буфера в 14 бит нужно выделить 2 байта
	
	shport 	 ; PORTx потра к которому подключен сдвиговый регистр
	shpin 	 ; PINx потра к которому подключен сдвиговый регистр
	shddr 	 ; DDRx потра к которому подключен сдвиговый регистр
	shbit	 ; Вывод данных
	clbit	 ; Стробирующий вывод


	BTCOUNT	 ; Регистр для счетчика бит 		0..7
	BUFCOUNT ; Регистр для счетчика буфера 	0..bitsize
	BUFREG   ; промежуточный буфер-регистр

Все регистры прячутся в стек в начале функции отправки и используются только
внутри нее. По окончании отправки они восстонавливаются.
[!!!] Если эти регистры используются в прерываниях перед вызовом функции
отравки прерывания необходимо отключить! Иначе есть риск изговнякат посылку.

Для удобного обращения к буферу отправки sBUF я написал несколько макросов:


	OUTsBUF		Записать БАЙТ в буфер sBUF
			@0 - № байта в буфере (ячейки) [0..bufsize]
			@1 - Данные

	OUTRsBUF	Передача содежимого РЕГИСТРА в буфер sBUF
			@0 - № байта в буфере (ячейки) [0..bufsize]
			@1 - Передаваемый регистр

	SETsBUF		Установить БИТ в буфере sBUF
			@0 - № байта в буфере (ячейки) [0..bufsize]
			@1 - № бита в определенном байте буфера отправки [0..7]

	CLRsBUF		Отчистить БИТ в буфере sBUF
			@0 - № байта в буфере (ячейки) [0..bufsize]
			@1 - № бита в определенном байте буфера отправки [0..7]

Для передачи данных из буфера в регистры необходимо только вызвать функцию:

	RCALL	SHIFTOUT

#### UPD
Добавлен пример использования <b>T13_LED_Line_Test</b>. Контроллер светодиодной линейки из 24х светодиодов и 3х сдвиговых регистров. Пример реализует циклически бегающую точку. 

###	Enjoy!

